SELECT
    tS.serviceTblPerson AS TblPerson_Id,
    tS.Id AS TblStudent_Id,

    -- Company Einschulung
    (select
		CONCAT (tC.Name,
			' ',
			tC.ExtendedName,
            ' ',
			tC.Description)
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN CorporationCompany_{{ ConsumerAcronym }}.tblCompany tC ON tC.Id = tST.serviceTblCompany
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ENROLLMENT'
    ) AS TblCompanyEnrollment_Name,

    -- other infos
    (select distinct
        tT.Name
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN EducationSchoolType_{{ ConsumerAcronym }}.tblType tT ON tST.serviceTblType = tT.Id
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ENROLLMENT'
    ) AS TblStudentTransferEnrollment_Type,
    (select distinct
        tC.Name
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN EducationSchoolCourse_{{ ConsumerAcronym }}.tblCourse tC ON tC.Id = tST.serviceTblCourse
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ENROLLMENT'
    ) AS TblStudentTransferEnrollment_Course,
    (select distinct
        DATE_FORMAT( tST.TransferDate, '%d.%m.%Y' ) AS TblStudentTransfer_TransferDate
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ENROLLMENT'
    ) AS TblStudentTransferEnrollment_TransferDate,
    (select distinct
        tST.Remark AS TblStudentTransfer_Remark
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ENROLLMENT'
    ) AS TblStudentTransferEnrollment_Remark,
    (select distinct
        tSSET.Name AS tblStudentSchoolEnrollmentType_Name
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentSchoolEnrollmentType tSSET ON tSSET.Id = tST.tblStudentSchoolEnrollmentType
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ENROLLMENT'
    ) AS TblStudentSchoolEnrollmentType_Name,

    -- Company Abgebende Schule
    (select
		CONCAT (tC.Name,
			' ',
			tC.ExtendedName,
            ' ',
			tC.Description)
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN CorporationCompany_{{ ConsumerAcronym }}.tblCompany tC ON tC.Id = tST.serviceTblCompany
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ARRIVE'
    ) AS TblCompanyArrive_Name,

    -- Company Aufnahme Staatliche Stammschule
    (select
    CONCAT (tC.Name,
			' ',
			tC.ExtendedName,
            ' ',
			tC.Description)
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN CorporationCompany_{{ ConsumerAcronym }}.tblCompany tC ON tC.Id = tST.serviceTblStateCompany
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ARRIVE'
    ) AS TblStateCompanyArrive_Name,

    -- other infos
    (select distinct
        tT.Name
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN EducationSchoolType_{{ ConsumerAcronym }}.tblType tT ON tST.serviceTblType = tT.Id
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ARRIVE'
    ) AS TblStudentTransferArrive_Type,
    (select distinct
        tC.Name
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN EducationSchoolCourse_{{ ConsumerAcronym }}.tblCourse tC ON tC.Id = tST.serviceTblCourse
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ARRIVE'
    ) AS TblStudentTransferArrive_Course,
    (select distinct
        DATE_FORMAT( tST.TransferDate, '%d.%m.%Y' ) AS TblStudentTransfer_TransferDate
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ARRIVE'
    ) AS TblStudentTransferArrive_TransferDate,
    (select distinct
        tST.Remark AS TblStudentTransfer_Remark
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'ARRIVE'
    ) AS TblStudentTransferArrive_Remark,

    -- Company weiterf√ºhrende Schule
    (select
		CONCAT (tC.Name,
			' ',
			tC.ExtendedName,
            ' ',
			tC.Description)
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN CorporationCompany_{{ ConsumerAcronym }}.tblCompany tC ON tC.Id = tST.serviceTblCompany
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'LEAVE'
    ) AS TblCompanyLeave_Name,

    -- other infos
    (select distinct
        tT.Name
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN EducationSchoolType_{{ ConsumerAcronym }}.tblType tT ON tST.serviceTblType = tT.Id
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'LEAVE'
    ) AS TblStudentTransferLeave_Type,
    (select distinct
        tC.Name
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN EducationSchoolCourse_{{ ConsumerAcronym }}.tblCourse tC ON tC.Id = tST.serviceTblCourse
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'LEAVE'
    ) AS TblStudentTransferLeave_Course,
    (select distinct
        DATE_FORMAT( tST.TransferDate, '%d.%m.%Y' ) AS TblStudentTransfer_TransferDate
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'LEAVE'
    ) AS TblStudentTransferLeave_TransferDate,
    (select distinct
        tST.Remark AS TblStudentTransfer_Remark
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'LEAVE'
    ) AS TblStudentTransferLeave_Remark,

    -- Company aktuelle Schule
    (select
		CONCAT (tC.Name,
			' ',
			tC.ExtendedName,
            ' ',
			tC.Description)
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN CorporationCompany_{{ ConsumerAcronym }}.tblCompany tC ON tC.Id = tST.serviceTblCompany
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'PROCESS'
    ) AS TblCompanyProcess_Name,

    -- other infos
    (select distinct
        tC.Name
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
        LEFT JOIN EducationSchoolCourse_{{ ConsumerAcronym }}.tblCourse tC ON tC.Id = tST.serviceTblCourse
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'PROCESS'
    ) AS TblStudentTransferProcess_Course,
    (select distinct
        tST.Remark AS TblStudentTransfer_Remark
    from PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransfer tST
        LEFT JOIN PeopleMeta_{{ ConsumerAcronym }}.tblStudentTransferType tSTT ON tSTT.Id = tST.tblStudentTransferType
    where tST.tblStudent =  tS.Id
        and tSTT.Identifier = 'PROCESS'
    ) AS TblStudentTransferProcess_Remark

FROM PeopleMeta_{{ ConsumerAcronym }}.tblStudent tS

WHERE tS.EntityRemove IS NULL